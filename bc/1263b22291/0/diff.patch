diff --git a/src/app/(dashboard)/[owner]/[repo]/[checkpointId]/page.tsx b/src/app/(dashboard)/[owner]/[repo]/[checkpointId]/page.tsx
index 36f7f95..9dc05ef 100644
--- a/src/app/(dashboard)/[owner]/[repo]/[checkpointId]/page.tsx
+++ b/src/app/(dashboard)/[owner]/[repo]/[checkpointId]/page.tsx
@@ -52,7 +52,7 @@ export default function CheckpointDetailPage({
   const { diff, isLoading: diffLoading } = useDiff(
     owner,
     repo,
-    checkpoint?.commit_hash || ""
+    checkpointId
   );
 
   const [activeTab, setActiveTab] = useState<Tab>("sessions");
diff --git a/src/app/api/github/repos/[owner]/[repo]/diff/[commitHash]/route.ts b/src/app/api/github/repos/[owner]/[repo]/checkpoints/[id]/diff/route.ts
similarity index 60%
rename from src/app/api/github/repos/[owner]/[repo]/diff/[commitHash]/route.ts
rename to src/app/api/github/repos/[owner]/[repo]/checkpoints/[id]/diff/route.ts
index f8adee8..4ecd8eb 100644
--- a/src/app/api/github/repos/[owner]/[repo]/diff/[commitHash]/route.ts
+++ b/src/app/api/github/repos/[owner]/[repo]/checkpoints/[id]/diff/route.ts
@@ -1,21 +1,19 @@
 import { NextResponse } from "next/server";
 import { auth } from "@/lib/auth";
 import { createOctokit } from "@/lib/github";
-import { getCommitDiff } from "@/lib/github/diff";
+import { getCheckpointDiff } from "@/lib/github/diff";
 
 export async function GET(
   _request: Request,
-  {
-    params,
-  }: { params: Promise<{ owner: string; repo: string; commitHash: string }> }
+  { params }: { params: Promise<{ owner: string; repo: string; id: string }> }
 ) {
   const session = await auth();
   if (!session?.accessToken) {
     return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
   }
 
-  const { owner, repo, commitHash } = await params;
+  const { owner, repo, id } = await params;
   const octokit = createOctokit(session.accessToken);
-  const diff = await getCommitDiff(octokit, owner, repo, commitHash);
+  const diff = await getCheckpointDiff(octokit, owner, repo, id);
   return NextResponse.json({ diff });
 }
diff --git a/src/hooks/use-checkpoints.ts b/src/hooks/use-checkpoints.ts
index 357d801..8f88b43 100644
--- a/src/hooks/use-checkpoints.ts
+++ b/src/hooks/use-checkpoints.ts
@@ -46,10 +46,10 @@ export function useSession(owner: string, repo: string, id: string) {
   };
 }
 
-export function useDiff(owner: string, repo: string, commitHash: string) {
+export function useDiff(owner: string, repo: string, checkpointId: string) {
   const { data, error, isLoading } = useSWR<{ diff: string }>(
-    commitHash
-      ? `/api/github/repos/${owner}/${repo}/diff/${commitHash}`
+    checkpointId
+      ? `/api/github/repos/${owner}/${repo}/checkpoints/${checkpointId}/diff`
       : null,
     fetcher
   );
diff --git a/src/lib/github/diff.ts b/src/lib/github/diff.ts
index 5f63940..cb40fd6 100644
--- a/src/lib/github/diff.ts
+++ b/src/lib/github/diff.ts
@@ -1,49 +1,49 @@
 import { Octokit } from "@octokit/rest";
 
-export async function getCommitDiff(
+const CHECKPOINT_BRANCH = "partio/checkpoints/v1";
+
+export async function getCheckpointDiff(
   octokit: Octokit,
   owner: string,
   repo: string,
-  commitHash: string
+  checkpointId: string
 ): Promise<string> {
-  // Try format: "diff" first
+  const shard = checkpointId.slice(0, 2);
+  const rest = checkpointId.slice(2);
+
   try {
-    const { data } = await octokit.repos.getCommit({
+    const { data: ref } = await octokit.git.getRef({
       owner,
       repo,
-      ref: commitHash,
-      mediaType: {
-        format: "diff",
-      },
+      ref: `heads/${CHECKPOINT_BRANCH}`,
     });
 
-    const diff = data as unknown as string;
-    if (diff && typeof diff === "string" && diff.includes("diff --git")) {
-      return diff;
-    }
-  } catch {
-    // Fall through to fallback
-  }
+    const { data: commit } = await octokit.git.getCommit({
+      owner,
+      repo,
+      commit_sha: ref.object.sha,
+    });
 
-  // Fallback: use standard commit endpoint to build a synthetic diff from file patches
-  try {
-    const { data } = await octokit.repos.getCommit({
+    const { data: tree } = await octokit.git.getTree({
       owner,
       repo,
-      ref: commitHash,
+      tree_sha: commit.tree.sha,
+      recursive: "1",
     });
 
-    if (!data.files || data.files.length === 0) return "";
-
-    return data.files
-      .map((file) => {
-        const header = `diff --git a/${file.filename} b/${file.filename}`;
-        const patch = file.patch || "";
-        return `${header}\n${patch}`;
-      })
-      .join("\n");
-  } catch (err) {
-    console.error("[diff] failed to fetch commit diff:", err);
+    const diffPath = `${shard}/${rest}/0/diff.patch`;
+    const entry = (tree.tree || []).find((e) => e.path === diffPath);
+
+    if (!entry?.sha) return "";
+
+    const { data: blob } = await octokit.git.getBlob({
+      owner,
+      repo,
+      file_sha: entry.sha,
+    });
+
+    return Buffer.from(blob.content, "base64").toString("utf-8");
+  } catch {
     return "";
   }
 }